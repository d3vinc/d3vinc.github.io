---
layout: page
title: Jest
permalink: /dev/jest.html
---

## Run with yarn/npm

### setup

config `package.json`

```
{
...
  "scripts": {
    "start": "node scripts/start.js",
    "test": "node scripts/test.js --env=jsdom",
...
}
```

`scripts/test.js` content

```
'use strict'

// Do this as the first thing so that any code reading it knows the right env.
process.env.BABEL_ENV = 'test'
process.env.NODE_ENV = 'test'
process.env.PUBLIC_URL = ''

// Makes the script crash on unhandled rejections instead of silently
// ignoring them. In the future, promise rejections that are not handled will
// terminate the Node.js process with a non-zero exit code.
process.on('unhandledRejection', err => {
  throw err
})

// Ensure environment variables are read.
require('../config/env')

const jest = require('jest')
const argv = process.argv.slice(2)

// Watch unless on CI or in coverage mode
if (!process.env.CI && argv.indexOf('--coverage') < 0) {
  argv.push('--watch')
}

jest.run(argv)
```

Notes: both `package.json` and files in `scripts` dir are generated by `create-react-app` CLI tool.

### command line

```
yarn test
```

test single file

```
yarn test src/index.test.js
```

test without watch mode

```
$ yarn test index.test.js -- --watchAll=false
```

Ref: https://stackoverflow.com/questions/39724017/running-cra-jest-in-non-interactive-mode

Generate for all the directories

```
$ yarn test --coverage
```

## Test environment

You can select with "jsdom"(default) and "node".

How to apply this environment variable:

Method 1: Globally, in command line option

```
$ jest --env node
```

Method 2: Globally, in `package.json`

```json
{
  "jest": {
    "testEnvironment": "node"
  }
}
```

Method 3: Per files, in `*.js` (available in Jest 20.0.0+)

```js
/**
 * @jest-environment jsdom
 */

test("use jsdom in this test file", () => {
  const element = document.createElement("div");
  expect(element).not.toBeNull();
});
```

## Code coverage report

Use this to exclude this file in the coverage report.

```
/* istanbul ignore file */
```

## test single

```
describe('Component', () => {
  test('Test no run', () => {
    ...
  })

  test('Test no run', () => {
    ...
  })

  test.only('Only this test run', () => {
    ...
  })
})
```

or

```
yarn test src/index.test.jsx
```

## compare object vs primitive value

```
expect({foo:'bar'}).toEqual({foo:'bar'}) // object
expect(1).toBe(1) // primitive value
```

## Config vs CLI

| Config                       | CLI                                                | Default Value |
| :--------------------------- | :------------------------------------------------- | ------------- |
| `"collectCoverage": true`    | --coverage=true or --coverage or --collectCoverage | `false`       |
| `"testEnvironment": "jsdom"` | `--env=jsdom`                                      | "node"        |

## References

- [Jest CLI Options](https://jestjs.io/docs/en/cli.html#--coverageboolean)
- [Configuring Jest](https://jestjs.io/docs/en/configuration.html)
